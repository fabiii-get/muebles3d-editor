<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Live Player</title>
  <!-- hls.js: HLS en navegadores que no soportan .m3u8 nativo -->
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <style>
    html,body{margin:0;height:100%;background:#000}
    #wrap{position:fixed;inset:0;background:#000}
    video{width:100%;height:100%;display:block;background:#000;outline:none}
    /* Overlay solo si el navegador bloquea sonido/FS; sin botones */
    #overlay{
      position:fixed;inset:0;display:none;place-items:center;
      background:rgba(0,0,0,.88);color:#fff;text-align:center;
      font-family:system-ui,-apple-system,Segoe UI,Arial;padding:24px
    }
    #overlay.show{display:grid}
  </style>
</head>
<body>
  <div id="wrap"><video id="v" autoplay playsinline></video></div>
  <div id="overlay"><div>⬆️ Doble-tap/doble-click para activar <b>sonido</b> y <b>pantalla completa</b>.</div></div>

  <script>
    // Stream por defecto (Crónica 720p). Cambiá acá o usa ?src=URL
    const DEFAULT_SRC = "https://g3.vxral-hor.transport.edge-access.net/a09/ngrp:cronicatv_video1-100044_all/cronicatv_video1-100044_720p.m3u8";
    const params = new URL(location.href).searchParams;
    const SRC = params.get("src") || DEFAULT_SRC;

    const video = document.getElementById("v");
    const overlay = document.getElementById("overlay");

    // 1) Intento inicial: autoplay en mute (lo exige el navegador)
    video.muted = true;

    // Pantalla completa
    async function requestFS(){
      const el = document.documentElement;
      try{
        if(!document.fullscreenElement){
          if (el.requestFullscreen) await el.requestFullscreen();
          else if (el.webkitRequestFullscreen) await el.webkitRequestFullscreen();
          else if (el.msRequestFullscreen) await el.msRequestFullscreen();
        }
      }catch(e){}
    }

    // Reproducir con sonido
    async function playWithSound(){
      try{ video.muted = false; video.volume = 1.0; }catch(e){}
      try{ await video.play(); }catch(e){}
    }

    // Ocultar overlay si ya está reproduciendo
    function autoHideOverlay(){
      const hide = ()=> overlay.classList.remove("show");
      video.addEventListener("playing", hide);
      video.addEventListener("volumechange", ()=>{ if(!video.muted) hide(); });
    }

    // Cargar stream
    function loadStream(url){
      autoHideOverlay();

      if (window.Hls && Hls.isSupported()) {
        const hls = new Hls({lowLatencyMode:true});
        hls.loadSource(url);
        hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED, async () => {
          try { await video.play(); } catch(e){}
          await requestFS();
          // Intento subir a sonido si el navegador ya lo permite en tu dominio (MEI)
          try { await playWithSound(); } catch(e) { overlay.classList.add("show"); }
        });
      } else if (video.canPlayType("application/vnd.apple.mpegurl")) {
        // Safari / iOS (HLS nativo)
        video.src = url;
        video.addEventListener("loadedmetadata", async ()=>{
          try { await video.play(); } catch(e){}
          await requestFS();
          try { await playWithSound(); } catch(e) { overlay.classList.add("show"); }
        });
      } else {
        // Si el navegador no soporta nada, mostramos overlay para gesto
        overlay.classList.add("show");
      }
    }

    // 2) Gesto del usuario: doble-tap/doble-click → sonido + fullscreen
    let lastTap = 0;
    function isDoubleTap(){
      const now = Date.now();
      const isDT = (now - lastTap) < 400; // 400ms ventana
      lastTap = now;
      return isDT;
    }
    document.addEventListener("pointerdown", async ()=>{
      if (isDoubleTap()){
        await requestFS();
        await playWithSound();
        overlay.classList.remove("show");
      }
    });

    // Arranque
    loadStream(SRC);

    // Sugerencia: usar siempre este mismo dominio (GitHub Pages).
    // Con el uso, Chrome puede habilitar autoplay con sonido (MEI).
  </script>
</body>
</html>
