<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cr√≥nica TV ‚Äì Live</title>

  <!-- hls.js para que HLS funcione en navegadores que no lo soportan nativo -->
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

  <style>
    html, body { margin:0; height:100%; background:#000; }
    #wrap { position:fixed; inset:0; background:#000; }
    video { width:100%; height:100%; display:block; background:#000; }

    /* Overlay para pedir un toque si el navegador bloquea audio/FS */
    #overlay {
      position:fixed; inset:0; display:none; place-items:center;
      background:rgba(0,0,0,.88); color:#fff; text-align:center;
      font-family:system-ui, -apple-system, Segoe UI, Arial;
      padding:24px;
    }
    #overlay.show { display:grid; }
    .card {
      background:#111; border:1px solid #2a2a2a; border-radius:14px;
      max-width:520px; padding:24px; box-shadow:0 8px 40px rgba(0,0,0,.5);
    }
    .card h1 { margin:.2rem 0 .6rem 0; font-size:1.15rem; }
    .card p { margin:.25rem 0 1rem 0; opacity:.9; }
    button {
      background:#e50914; color:#fff; border:0; padding:12px 18px;
      border-radius:10px; font-size:1rem; cursor:pointer;
    }
    button:hover { filter:brightness(1.06); }
  </style>
</head>
<body>
  <div id="wrap">
    <video id="v" autoplay playsinline controls></video>
  </div>

  <div id="overlay" class="show">
    <div class="card">
      <h1>‚ñ∂ Reproducir con sonido y pantalla completa</h1>
      <p>Tu navegador puede bloquear el audio autom√°tico. Toc√° el bot√≥n para activar <b>sonido + pantalla completa</b>.</p>
      <button id="start">Reproducir ahora</button>
    </div>
  </div>

  <script>
    // Stream por defecto (Cr√≥nica 720p). Pod√©s reemplazarlo o pasar ?src=URL
    const DEFAULT_SRC = "https://g3.vxral-hor.transport.edge-access.net/a09/ngrp:cronicatv_video1-100044_all/cronicatv_video1-100044_720p.m3u8";
    const src = new URL(location.href).searchParams.get("src") || DEFAULT_SRC;

    const video = document.getElementById("v");
    const overlay = document.getElementById("overlay");
    const startBtn = document.getElementById("start");

    // Pide pantalla completa
    async function requestFS() {
      const el = document.documentElement;
      if (document.fullscreenElement) return;
      try {
        if (el.requestFullscreen) await el.requestFullscreen();
        else if (el.webkitRequestFullscreen) await el.webkitRequestFullscreen();
        else if (el.msRequestFullscreen) await el.msRequestFullscreen();
      } catch (e) { /* ignorar */ }
    }

    // Intenta reproducir con sonido
    async function playWithSound() {
      try { video.muted = false; video.volume = 1.0; } catch(e){}
      try { await video.play(); } catch (e) {}
    }

    // Carga HLS (con hls.js si hace falta)
    function loadStream(url) {
      if (window.Hls && Hls.isSupported()) {
        const hls = new Hls({ lowLatencyMode: true });
        hls.loadSource(url);
        hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED, async () => {
          // Primer intento: autoplay (algunos navegadores solo permiten con mudo)
          try { await video.play(); } catch(e) {}
          // Mostramos overlay para capturar gesto y habilitar sonido + FS
          overlay.classList.add("show");
        });
        hls.on(Hls.Events.ERROR, (ev, data) => {
          if (data.fatal) console.warn("HLS fatal:", data);
        });
      } else if (video.canPlayType("application/vnd.apple.mpegurl")) {
        // Safari / iOS
        video.src = url;
        video.addEventListener("loadedmetadata", async () => {
          try { await video.play(); } catch(e) {}
          overlay.classList.add("show");
        });
      } else {
        // √öltimo recurso: dejamos overlay visible para que el usuario toque y reintente
        overlay.classList.add("show");
      }
    }

    // Bot√≥n: gesto del usuario ‚Üí sonido + fullscreen
    startBtn.addEventListener("click", async () => {
      await requestFS();
      await playWithSound();
      overlay.classList.remove("show");
    });

    // Tambi√©n si el usuario toca el video
    video.addEventListener("click", async () => {
      if (video.muted || !document.fullscreenElement) {
        await requestFS();
        await playWithSound();
        overlay.classList.remove("show");
      }
    });

    // Arranque
    loadStream(src);

    // üîî CONSEJO para que Chrome permita audio autom√°tico (MEI):
    // Visit√° esta misma URL varias veces, dej√° que el video suene despu√©s de un toque,
    // y no bajes el volumen del sitio. Chrome sube el ‚ÄúMedia Engagement Index‚Äù.
    // Con el tiempo, puede habilitar autoplay con sonido en visitas futuras a ESTE dominio.
  </script>
</body>
</html>
