<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot con Limpieza</title>
    <style>
        body { font-family: sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; background-color: #f0f0f0; margin: 0; }
        .chat-container { width: 400px; background-color: white; box-shadow: 0 0 10px rgba(0,0,0,0.1); border-radius: 8px; display: flex; flex-direction: column; }
        .chat-box { height: 300px; overflow-y: auto; padding: 15px; border-bottom: 1px solid #ddd; }
        .message { margin-bottom: 10px; padding: 8px 12px; border-radius: 18px; max-width: 70%; }
        .user-message { background-color: #007bff; color: white; align-self: flex-end; margin-left: auto; }
        .bot-message { background-color: #e9e9eb; color: #333; align-self: flex-start; margin-right: auto; }
        .system-message { background-color: #f0f0f0; color: #555; font-style: italic; text-align: center; padding: 5px; margin-bottom:10px; border-radius: 5px;}
        .input-area { display: flex; padding: 10px; }
        .input-area input { flex-grow: 1; padding: 10px; border: 1px solid #ddd; border-radius: 20px; margin-right: 10px; }
        .input-area button { 
            padding: 10px 15px; 
            background-color: #007bff; 
            color: white; 
            border: none; 
            border-radius: 20px; 
            cursor: pointer; 
            margin-left: 5px; /* Added margin for spacing between buttons */
        }
        /* Specific style for clear button if needed, e.g., different color */
        #clear-chat-button {
            background-color: #6c757d; /* A different color, e.g., grey */
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-box" id="chatBox">
            <div class="message bot-message">¬°Hola! Soy tu asistente virtual.</div>
        </div>
        <div class="input-area">
            <input type="text" id="userInput" placeholder="Escribe un mensaje...">
            <button onclick="sendMessage()">Enviar</button>
            <button id="clear-chat-button" onclick="clearChat()">Limpiar Chat</button>
        </div>
    </div>

    <script>
        let sessionData = {};
        let lastAiTopic = null; // For basic context handling

        const rules = [
            { // Greeting Rule
                patterns: ["hola", "buenos d√≠as", "buenas tardes", "buenas noches", "qu√© tal", "hey", "saludos"],
                response: function(message) {
                    lastAiTopic = null; 
                    let GREETING_RESPONSES;
                    if (sessionData.userName) {
                        GREETING_RESPONSES = [
                            `¬°Hola de nuevo, ${sessionData.userName}! ¬øEn qu√© te puedo ayudar? üëã`,
                            `¬°Qu√© bueno verte otra vez, ${sessionData.userName}! üòä`,
                            `¬°Saludos, ${sessionData.userName}! Listo para lo que necesites.`
                        ];
                    } else {
                        GREETING_RESPONSES = [
                            "¬°Hola! ¬øEn qu√© puedo ayudarte hoy? üëã",
                            "¬°Saludos! ¬øQu√© tal tu d√≠a? üòä",
                        ];
                    }
                    return GREETING_RESPONSES[Math.floor(Math.random() * GREETING_RESPONSES.length)];
                }
            },
            { // Name Capture Rule
                patterns: [/^(?:mi nombre es|me llamo|soy)\s+([a-zA-Z√°√©√≠√≥√∫√±√Å√â√ç√ì√ö√ë\s]+)$/i],
                response: function(message) {
                    const match = message.match(/^(?:mi nombre es|me llamo|soy)\s+([a-zA-Z√°√©√≠√≥√∫√±√Å√â√ç√ì√ö√ë\s]+)$/i);
                    if (match && match[1]) {
                        sessionData.userName = match[1].trim();
                        lastAiTopic = null; 
                        const ACKNOWLEDGMENTS = [
                            `Entendido. ¬°Hola, ${sessionData.userName}! üòÑ`,
                            `¬°Un placer conocerte, ${sessionData.userName}! üëã`,
                        ];
                        return ACKNOWLEDGMENTS[Math.floor(Math.random() * ACKNOWLEDGMENTS.length)];
                    }
                    return "No entend√≠ bien tu nombre. ¬øPodr√≠as repetirlo?";
                }
            },
            { // Likes Capture Rule
                patterns: [/^(?:me gusta(?:n)?|disfruto|amo)\s+(.+)$/i],
                response: function(message) {
                    const match = message.match(/^(?:me gusta(?:n)?|disfruto|amo)\s+(.+)$/i);
                    if (match && match[1]) {
                        sessionData.userLikes = match[1].trim();
                        lastAiTopic = null; 
                        const ACKNOWLEDGMENTS = [
                            `Entendido. Te gusta(n) ${sessionData.userLikes}. ¬°Qu√© interesante! üëç`,
                            `¬°Qu√© bien que te guste(n) ${sessionData.userLikes}! üòä`,
                        ];
                        return ACKNOWLEDGMENTS[Math.floor(Math.random() * ACKNOWLEDGMENTS.length)];
                    }
                    return "No capt√© bien lo que te gusta. ¬øPuedes decirlo de otra forma?";
                }
            },
            { // AI Identity Rule
                patterns: ["qui√©n sos", "quien eres", "qu√© eres", "presentate", "cu√°l es tu nombre", "como te llamas"],
                response: function(message) {
                    const IDENTITY_RESPONSES_WITH_CONTEXT = [
                        { text: "Soy tu IA personal, lista para ayudar. ü§ñ", topic: "ai_identity_context" },
                        { text: "Puedes pensar en m√≠ como un asistente virtual. üòâ", topic: "ai_identity_context" },
                        { text: "No tengo un nombre, ¬°pero estoy aqu√≠ para ti! üëç", topic: null } 
                    ];
                    const selected = IDENTITY_RESPONSES_WITH_CONTEXT[Math.floor(Math.random() * IDENTITY_RESPONSES_WITH_CONTEXT.length)];
                    lastAiTopic = selected.topic;
                    return selected.text;
                }
            },
            { // AI Status Rule
                patterns: ["c√≥mo est√°s", "como estas", "c√≥mo te va", "que tal estas", "todo bien"],
                response: function(message) {
                    const STATUS_RESPONSES_WITH_CONTEXT = [
                        { text: "¬°Funcionando perfectamente! ‚ú®", topic: "ai_status_context" },
                        { text: "Estoy lista y esperando tus preguntas. ü§ì", topic: "ai_status_context" },
                        { text: "¬°Todo en orden por aqu√≠! ¬øY t√∫? ü§ó", topic: null } 
                    ];
                    if (sessionData.userName) {
                        STATUS_RESPONSES_WITH_CONTEXT.push({text: `Todo bien, ${sessionData.userName}, ¬°listo para ayudar!`, topic: "ai_status_context"});
                    }
                    const selected = STATUS_RESPONSES_WITH_CONTEXT[Math.floor(Math.random() * STATUS_RESPONSES_WITH_CONTEXT.length)];
                    lastAiTopic = selected.topic;
                    return selected.text;
                }
            },
            { // Follow-up Rule
                patterns: ["por qu√©?", "y eso?", "por que", "dime m√°s", "explica m√°s", "contin√∫a", "profundiza", "como es eso?"],
                response: function(message) {
                    if (lastAiTopic === "ai_identity_context") {
                        lastAiTopic = null; 
                        return "Fui creada para asistirte con informaci√≥n y tareas. Mi programaci√≥n se basa en reconocer patrones en tu texto y ofrecerte la respuesta m√°s adecuada que tengo disponible. ü§ì";
                    } else if (lastAiTopic === "ai_status_context") {
                        lastAiTopic = null; 
                        return "Eso significa que todos mis sistemas internos est√°n operativos y listos para procesar tus solicitudes. ¬°Estoy aqu√≠ para ayudarte! üí™";
                    } else {
                        return "No estoy segura de a qu√© te refieres con eso. ¬øPodr√≠as ser m√°s espec√≠fico o recordarme de qu√© est√°bamos hablando? ü§î";
                    }
                }
            },
            { // Farewell Rule
                patterns: ["adi√≥s", "chau", "hasta luego", "nos vemos", "hasta pronto"],
                response: function(message) {
                    lastAiTopic = null; 
                    let farewell = "¬°Adi√≥s! Que tengas un buen d√≠a. ‚òÄÔ∏è";
                    if (sessionData.userName) {
                        farewell = `¬°Adi√≥s, ${sessionData.userName}! Que tengas un excelente d√≠a. üòä`;
                    }
                    const FAREWELL_RESPONSES = [ farewell, "¬°Hasta pronto! üëã", "¬°Nos vemos! Cu√≠date. üëç"];
                    return FAREWELL_RESPONSES[Math.floor(Math.random() * FAREWELL_RESPONSES.length)];
                }
            },
            { // Help Rule
                patterns: [/ayuda/, /necesito.*soporte/, /info/],
                response: function(message) {
                    lastAiTopic = null; 
                    let helpResponse = "Claro, dime qu√© necesitas. Estoy aqu√≠ para asistirte. üõ†Ô∏è";
                    if (sessionData.userName) {
                        helpResponse = `Claro, ${sessionData.userName}, dime qu√© necesitas. Estoy aqu√≠ para asistirte. üõ†Ô∏è`;
                    }
                     return helpResponse;
                }
            }
        ];

        function generarRespuesta(message) {
            const lowerMessage = message.toLowerCase();
            for (const rule of rules) {
                for (const pattern of rule.patterns) {
                    let match = false;
                    if (pattern instanceof RegExp) {
                        if (pattern.test(message)) { match = true; }
                    } else if (typeof pattern === 'string') {
                        if (lowerMessage.includes(pattern.toLowerCase())) { match = true; }
                    }
                    if (match) { return rule.response(message); }
                }
            }
            lastAiTopic = null; 
            return "Lo siento, todav√≠a estoy aprendiendo. ü§ñ";
        }

        function sendMessage() {
            const userInput = document.getElementById('userInput');
            const chatBox = document.getElementById('chatBox');
            const messageText = userInput.value.trim();

            if (messageText === "") return;

            const userDiv = document.createElement('div');
            userDiv.className = 'message user-message';
            userDiv.textContent = messageText;
            chatBox.appendChild(userDiv);

            const botResponse = generarRespuesta(messageText);
            const botDiv = document.createElement('div');
            botDiv.className = 'message bot-message';
            botDiv.textContent = botResponse;
            chatBox.appendChild(botDiv);

            userInput.value = "";
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        function clearChat() {
            const chatBox = document.getElementById('chatBox');
            chatBox.innerHTML = ''; // Clear messages from display

            sessionData = {}; // Reset session data
            lastAiTopic = null; // Reset last AI topic

            // Optionally, add a message indicating the chat was cleared
            const clearedDiv = document.createElement('div');
            clearedDiv.className = 'message system-message'; // Use a distinct class for system messages
            clearedDiv.textContent = "Chat limpiado. Se ha reiniciado la sesi√≥n.";
            chatBox.appendChild(clearedDiv);
            
            // Optionally, add the initial bot message again
            const initialBotMessage = document.createElement('div');
            initialBotMessage.className = 'message bot-message';
            initialBotMessage.textContent = "¬°Hola! Soy tu asistente virtual.";
            chatBox.appendChild(initialBotMessage);

            chatBox.scrollTop = chatBox.scrollHeight;
        }

        document.getElementById('userInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
    </script>
</body>
</html>
