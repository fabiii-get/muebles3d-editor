<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Plan de corte de placa</title>
  <style>
    body {
      font-family: sans-serif;
      display: flex;
      gap: 2rem;
      padding: 1rem;
    }
    .panel {
      width: 300px;
    }
    input {
      width: 100%;
      margin-bottom: 0.5rem;
      padding: 0.3rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    table, th, td {
      border: 1px solid #aaa;
    }
    th, td {
      padding: 4px;
      text-align: center;
    }
    canvas {
      border: 2px solid #444;
      background: #fdfdfd;
    }
  </style>
</head>
<body>
  <div class="panel">
    <h2>Cargar corte</h2>
    <label>Ancho (mm):</label>
    <input id="ancho" type="number" />
    <label>Alto (mm):</label>
    <input id="alto" type="number" />
    <button onclick="agregarCorte()">Agregar corte</button>
    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>Ancho</th>
          <th>Alto</th>
        </tr>
      </thead>
      <tbody id="listaCortes"></tbody>
    </table>
  </div>

  <div>
    <h2>Placa (2600x1800 mm)</h2>
    <canvas id="canvas" width="1040" height="720"></canvas>
  </div>

  <script>
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");

    const escala = 0.4; // 1 mm = 0.4 px
    const placaAncho = 2600;
    const placaAlto = 1800;
    const cortes = [];

    function agregarCorte() {
      const ancho = parseInt(document.getElementById("ancho").value);
      const alto = parseInt(document.getElementById("alto").value);

      if (isNaN(ancho) || isNaN(alto) || ancho <= 0 || alto <= 0) {
        alert("Cargá medidas válidas.");
        return;
      }

      cortes.push({ ancho, alto });
      actualizarTabla();
      dibujarPlaca();
    }

    function actualizarTabla() {
      const lista = document.getElementById("listaCortes");
      lista.innerHTML = "";
      cortes.forEach((corte, index) => {
        lista.innerHTML += `<tr>
          <td>${index + 1}</td>
          <td>${corte.ancho}</td>
          <td>${corte.alto}</td>
        </tr>`;
      });
    }

    function dibujarPlaca() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Borde de placa
      ctx.strokeStyle = "#000";
      ctx.strokeRect(0, 0, placaAncho * escala, placaAlto * escala);

      let x = 0;
      let y = 0;
      let filaAlto = 0;

      ctx.fillStyle = "#87cefa"; // color de los cortes

      cortes.forEach((corte, i) => {
        const w = corte.ancho * escala;
        const h = corte.alto * escala;

        if (x + w > placaAncho * escala) {
          x = 0;
          y += filaAlto;
          filaAlto = 0;
        }

        if (y + h > placaAlto * escala) {
          console.warn("Sin espacio para el corte", corte);
          return;
        }

        ctx.fillRect(x, y, w, h);
        ctx.strokeRect(x, y, w, h);
        ctx.fillStyle = "#000";
        ctx.font = "10px Arial";
        ctx.fillText(`${corte.ancho}x${corte.alto}`, x + 2, y + 12);
        ctx.fillStyle = "#87cefa";

        x += w;
        if (h > filaAlto) filaAlto = h;
      });
    }

    dibujarPlaca(); // primer dibujo vacío
  </script>
</body>
</html>
